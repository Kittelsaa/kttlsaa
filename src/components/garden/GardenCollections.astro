---
import FunTitle from '../FunTitle.astro';
import FunSubtitle from '../FunSubtitle.astro';

const { topics, counts } = Astro.props;

// Filter out "COMMUNITY" and "SOCIETY" from the topics list
const filteredTopics = topics.filter(topic => topic !== "COMMUNITY" && topic !== "SOCIETY");
---

<div class="collections-container">
  <h2 class="section-title">ONGOING COLLECTION</h2>
  
  <div class="collections-table">
    <!-- First row with 2 columns -->
    <div class="fixed-collections">
      <div class="collection-item fixed-item">
        <h3 class="item-title">BOOKSHELF</h3>
        <p class="item-desc">A list of the books I'm reading, sometimes with additional notes.</p>
      </div>
      
      <div class="collection-item fixed-item">
        <h3 class="item-title">MAP OF INQUIRY</h3>
        <p class="item-desc">A map of the subjects I find interesting and want to learn more about.</p>
      </div>
    </div>
    
    <!-- Topics grid with 3 columns -->
    <div class="topics-grid">
      {filteredTopics.map(topic => (
        <div class="collection-item topic-item" data-topic={topic}>
          <h3 class="item-title">{topic}</h3>
          <p class="item-desc">{counts[topic]} {counts[topic] === 1 ? 'item' : 'items'}</p>
        </div>
      ))}
    </div>
  </div>
</div>

<style>
  .collections-container {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  
  .section-title {
    color: #666;
    margin-bottom: 1rem;
    font-size: 1.2rem;
    font-weight: normal;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }
  
  .collections-table {
    border: 1px solid #C0C0C0;
    overflow: hidden;
    display: grid;
    grid-template-rows: auto auto;
  }
  
  .fixed-collections {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    border-bottom: 1px solid #C0C0C0;
  }
  
  .topics-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: repeat(2, auto);
  }
  
  .collection-item {
    padding: 1.5rem;
    position: relative;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
  }
  
  /* Add borders to specific cells */
  .fixed-collections .collection-item:first-child {
    border-right: 1px solid #C0C0C0;
  }
  
  /* First row of topics */
  .topics-grid .collection-item:nth-child(1),
  .topics-grid .collection-item:nth-child(2) {
    border-right: 1px solid #C0C0C0;
    border-bottom: 1px solid #C0C0C0;
  }
  
  .topics-grid .collection-item:nth-child(3) {
    border-bottom: 1px solid #C0C0C0;
  }
  
  /* Second row of topics */
  .topics-grid .collection-item:nth-child(4) {
    border-right: 1px solid #C0C0C0;
  }
  
  .item-title {
    margin: 0;
    font-size: 1rem;
    font-weight: bold;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 0.5rem;
  }
  
  .item-desc {
    margin: 0;
    font-size: 0.9rem;
    color: #666;
    line-height: 1.4;
  }
  
  .topic-item {
    cursor: pointer;
    transition: background-color 0.2s ease;
  }
  
  .topic-item:hover {
    background-color: #f8f8f8;
  }
  
  .topic-item.active {
    background-color: #f0f0f0;
  }
  
  @media (max-width: 768px) {
    .fixed-collections,
    .topics-grid {
      grid-template-columns: 1fr;
    }
    
    .fixed-collections .collection-item:first-child {
      border-right: none;
      border-bottom: 1px solid #C0C0C0;
    }
    
    .topics-grid .collection-item {
      border-right: none !important;
    }
    
    .topics-grid .collection-item:not(:last-child) {
      border-bottom: 1px solid #C0C0C0;
    }
  }
</style>

<script>
  // Add client-side filtering logic for topic items
  const topicItems = document.querySelectorAll('.topic-item');
  const noteCards = document.querySelectorAll('.note-card');
  
  topicItems.forEach(item => {
    item.addEventListener('click', () => {
      // Toggle active class on the clicked item
      item.classList.toggle('active');
      
      // Get all active topics
      const activeTopics = Array.from(document.querySelectorAll('.topic-item.active'))
        .map(activeItem => activeItem.dataset.topic);
      
      // Filter note cards based on active topics
      noteCards.forEach(card => {
        const cardTopics = card.dataset.topics?.split(',') || [];
        
        if (activeTopics.length === 0 || cardTopics.some(topic => activeTopics.includes(topic))) {
          card.style.display = 'block';
        } else {
          card.style.display = 'none';
        }
      });
    });
  });
</script>



















